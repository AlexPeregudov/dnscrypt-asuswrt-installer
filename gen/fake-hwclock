#!/bin/sh
SCRIPT=$(readlink -f "$0")
SCRIPTPATH=$(dirname "$SCRIPT")
TIME_FILE=${SCRIPTPATH}/fake-hwclock.data

COMMAND=$1

case $COMMAND in
  save)
    date -u '+%Y-%m-%d %H:%M:%S' > $TIME_FILE
    ;;
  load)
    [ -e $TIME_FILE ] && date -u -s "`cat $TIME_FILE`"
    if [ `nvram get ntp_ready` -eq 0 ]; then
      cru a FAKERTC "*/15 * * * * ${SCRIPTPATH}/fake-hwclock save"
    fi
    ;;
esac
