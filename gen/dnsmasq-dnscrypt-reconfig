#!/bin/sh

[ -z "`pidof dnscrypt-proxy`" ] && exit 0
[ -f /jffs/dnscrypt/.config ] && . /jffs/dnscrypt/.config

append_on_demand () {
  TARGET="$1"
  shift
  for LINE in "$@"; do
    if [ -z "`grep -F \"$LINE\" $TARGET`" ]; then
      echo "$LINE" >> $TARGET
    fi
  done
}

append_on_demand /etc/dnsmasq.conf "no-resolv" "server=127.0.0.1#65053"
[ "$DNS2" ] && append_on_demand /etc/dnsmasq.conf "server=127.0.0.1#65054"
